/*
 Copyright (c) 2003-2016, CKSource - Frederico Knabben. All rights reserved.

 For licensing, see LICENSE.md or http://ckeditor.com/license

*/
CKEDITOR.plugins.add("enhancedcolorbutton",{requires:"panelbutton,floatpanel",lang:"en,zh-cn",icons:"bgcolor,textcolor",hidpi:!0,init:function(c){function t(b,d,e,k){var a=new CKEDITOR.style(l["colorButton_"+d+"Style"]),g=CKEDITOR.tools.getNextId()+"_colorBox";c.ui.add(b,CKEDITOR.UI_PANELBUTTON,{label:e,title:e,modes:{wysiwyg:1},editorFocus:0,toolbar:"colors,"+k,allowedContent:a,requiredContent:a,panel:{css:CKEDITOR.skin.getPath("editor"),attributes:{role:"listbox","aria-label":h.panelTitle}},onBlock:function(v,
b){b.autoSize=!0;b.element.addClass("cke_colorblock");b.element.setHtml(w(v,d,g));b.element.getDocument().getBody().setStyle("overflow","hidden");CKEDITOR.ui.fire("ready",this);var a=b.keys,n="rtl"==c.lang.dir;a[n?37:39]="next";a[40]="next";a[9]="next";a[n?39:37]="prev";a[38]="prev";a[CKEDITOR.SHIFT+9]="prev";a[32]="click"},refresh:function(){c.activeFilter.check(a)||this.setState(CKEDITOR.TRISTATE_DISABLED)},onOpen:function(){var b=c.getSelection(),b=b&&b.getStartElement(),b=c.elementPath(b),a;if(b){b=
b.block||b.blockLimit||c.document.getBody();do a=b&&b.getComputedStyle("back"==d?"background-color":"color")||"transparent";while("back"==d&&"transparent"==a&&b&&(b=b.getParent()));a&&"transparent"!=a||(a="#ffffff");!1!==l.colorButton_enableAutomatic&&this._.panel._.iframe.getFrameDocument().getById(g).setStyle("background-color",a);return a}}})}function w(n,d,e){var k=[],a=l.colorButton_colors.split(","),g=c.plugins.colordialog&&!1!==l.colorButton_enableMore,f=a.length+(g?2:1),p=CKEDITOR.tools.addFunction(function(a,
d){function e(a){this.removeListener("ok",e);this.removeListener("cancel",e);"ok"==a.name&&g(this.getContentElement("picker","selectedColor").getValue(),d)}var g=arguments.callee;if("?"==a)c.openDialog("colordialog",function(){this.on("ok",e);this.on("cancel",e)});else{c.focus();n.hide();c.fire("saveSnapshot");c.removeStyle(new CKEDITOR.style(l["colorButton_"+d+"Style"],{color:"inherit"}));if(a){var f=l["colorButton_"+d+"Style"];f.childRule="back"==d?function(a){return u(a)}:function(a){return!(a.is("a")||
a.getElementsByTag("a").count())||u(a)};c.applyStyle(new CKEDITOR.style(f,{color:a}))}"fore"==d?(b.previousForeColor=a?a:"",b.currentTextColorDiv.style.backgroundColor=b.previousForeColor):(b.previousBackColor=a?a:"",b.currentBgColorDiv.style.backgroundColor=b.previousBackColor);c.fire("saveSnapshot")}});b.applyColorStyle=p;!1!==l.colorButton_enableAutomatic&&k.push('\x3ca class\x3d"cke_colorauto" _cke_focus\x3d1 hidefocus\x3dtrue title\x3d"',h.auto,'" onclick\x3d"CKEDITOR.tools.callFunction(',p,
",null,'",d,"');return false;\" href\x3d\"javascript:void('",h.auto,'\')" role\x3d"option" aria-posinset\x3d"1" aria-setsize\x3d"',f,'"\x3e\x3ctable role\x3d"presentation" cellspacing\x3d0 cellpadding\x3d0 width\x3d"100%"\x3e\x3ctr\x3e\x3ctd\x3e\x3cspan class\x3d"cke_colorbox" id\x3d"',e,'"\x3e\x3c/span\x3e\x3c/td\x3e\x3ctd colspan\x3d7 align\x3dcenter\x3e',h.auto,"\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/a\x3e");k.push('\x3ctable role\x3d"presentation" cellspacing\x3d0 cellpadding\x3d0 width\x3d"100%"\x3e');
for(e=0;e<a.length;e++){0===e%8&&k.push("\x3c/tr\x3e\x3ctr\x3e");var m=a[e].split("/"),q=m[0],r=m[1]||q;m[1]||(q="#"+q.replace(/^(.)(.)(.)$/,"$1$1$2$2$3$3"));m=c.lang.enhancedcolorbutton.colors[r]||r;k.push('\x3ctd\x3e\x3ca class\x3d"cke_colorbox" _cke_focus\x3d1 hidefocus\x3dtrue title\x3d"',m,'" onclick\x3d"CKEDITOR.tools.callFunction(',p,",'",q,"','",d,"'); return false;\" href\x3d\"javascript:void('",m,'\')" role\x3d"option" aria-posinset\x3d"',e+2,'" aria-setsize\x3d"',f,'"\x3e\x3cspan class\x3d"cke_colorbox" style\x3d"background-color:#',
r,'"\x3e\x3c/span\x3e\x3c/a\x3e\x3c/td\x3e')}g&&k.push('\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d8 align\x3dcenter\x3e\x3ca class\x3d"cke_colormore" _cke_focus\x3d1 hidefocus\x3dtrue title\x3d"',h.more,'" onclick\x3d"CKEDITOR.tools.callFunction(',p,",'?','",d,"');return false;\" href\x3d\"javascript:void('",h.more,"')\"",' role\x3d"option" aria-posinset\x3d"',f,'" aria-setsize\x3d"',f,'"\x3e',h.more,"\x3c/a\x3e\x3c/td\x3e");k.push("\x3c/tr\x3e\x3c/table\x3e");return k.join("")}function u(b){return"false"==
b.getAttribute("contentEditable")||b.getAttribute("data-nostyle")}var l=c.config,h=c.lang.enhancedcolorbutton,f=document.createElement("link");f.setAttribute("rel","stylesheet");f.setAttribute("type","text/css");f.setAttribute("href",this.path+"css/content.css");document.getElementsByTagName("head")[0].appendChild(f);var b=b||{};CKEDITOR.env.hc||(t("TextColor2","fore",h.textColorTitle,10),t("BGColor2","back",h.bgColorTitle,20),c.ui.addButton("TextColor",{label:h.textColorTitle,command:"setForeFontColor",
toolbar:"colors,9"}),c.ui.addButton("BGColor",{label:h.bgColorTitle,command:"setBackFontColor",toolbar:"colors,19"}));c.addCommand("setForeFontColor",{exec:function(c,d){d=d||b.previousForeColor;CKEDITOR.tools.callFunction(b.applyColorStyle,d,"fore")}});c.addCommand("setBackFontColor",{exec:function(c,d){d=d||b.previousBackColor;CKEDITOR.tools.callFunction(b.applyColorStyle,d,"back")}});f=function(c,d){return function(){if(!b.currentTextColorDiv||!b.currentBgColorDiv){var e=document.getElementById("cke_"+
c.name).querySelectorAll(".cke_button_icon.cke_button__textcolor_icon")[0],f=document.getElementById("cke_"+c.name).querySelectorAll(".cke_button_icon.cke_button__bgcolor_icon")[0],a=document.createElement("div"),g=document.createElement("div");a.setAttribute("id",c.name+"_enhanced_color_button_text");g.setAttribute("id",c.name+"_enhanced_color_button_bg");a.classList?(a.classList.add("enhanced_color_button_text_color"),g.classList.add("enhanced_color_button_bg_color")):(a.className+=" enhanced_color_button_text_color",
g.className+=" enhanced_color_button_bg_color");e.appendChild(a);f.appendChild(g);b.currentTextColorDiv=a;b.currentBgColorDiv=g;c.removeListener("instanceReady",d)}}};c.on("instanceReady",f(c,f))}});CKEDITOR.config.colorButton_colors="000,800000,8B4513,2F4F4F,008080,000080,4B0082,696969,B22222,A52A2A,DAA520,006400,40E0D0,0000CD,800080,808080,F00,FF8C00,FFD700,008000,0FF,00F,EE82EE,A9A9A9,FFA07A,FFA500,FFFF00,00FF00,AFEEEE,ADD8E6,DDA0DD,D3D3D3,FFF0F5,FAEBD7,FFFFE0,F0FFF0,F0FFFF,F0F8FF,E6E6FA,FFF";
CKEDITOR.config.colorButton_foreStyle={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]};CKEDITOR.config.colorButton_backStyle={element:"span",styles:{"background-color":"#(color)"}};